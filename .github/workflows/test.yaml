name: Run Postman Tests

on: push

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Start FastAPI app
      run: |
        nohup fastapi run app/main.py --port 80 &
        sleep 10
    - name: Install Postman CLI
      run: |
        curl -o- "https://dl-cli.pstmn.io/install/linux64.sh" | sh
    - name: Login to Postman CLI
      run: postman login --with-api-key ${{ secrets.POSTMAN_TOKEN }}
    - name: Run Postman Tests
      run: |
        # Run Postman tests
        postman collection run 9159996-665daf2b-19c2-4b0c-8fb5-a70fb707f442 -e 9159996-08aa1a9a-c17a-4441-9950-5e3a72e628a0
