name: Run Postman Tests

on: push

jobs:
  postman-test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Start FastAPI App
      run: |
        nohup fastapi run app/main.py --port 8000 &
        sleep 10

    - name: Install Postman CLI
      run: |
        curl -o- "https://dl-cli.pstmn.io/install/linux64.sh" | sh

    - name: Login to Postman CLI
      run: |
        postman login --with-api-key ${{ secrets.POSTMAN_TOKEN }}

    - name: Run Postman Tests
      run: |
        # Run Postman tests
        postman collection run 9159996-20961b0d-bf53-445d-ad18-4f6f31d69009 -e 9159996-bdc3bc36-e5f3-47f2-ab24-336e8c72e582
